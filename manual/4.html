<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">
  code{white-space: pre;}
  .break { page-break-before: always; }
  </style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { margin-left: 50px; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="github.css">
</head>
<body>
<h1>４．ゲームを作ろう</h1>
<h2>ゲームの作り方</h2>
<p>ゲームをはじめとしたソフトウェアを開発するには、まず『設計』という作業をします。<br />いきなりプログラムを書き始めるのではなく、どのようなソフトウェアを作りたいのか、最初に考えることはとても重要です。</p>
<ul>
<li>作りたいゲームをイメージしてみよう</li>
<li>イメージしたものを紙に描いてみよう</li>
<li>キャラクターをデザインしよう</li>
<li>背景をデザインしよう</li>
<li>キャラクターの動きを決めよう</li>
<li>キーボードやマウスを使ったキャラクターの動かし方を決めよう</li>
<li>プログラムの構成を考えよう</li>
</ul>
<h2 class="break">今回のゲーム</h2>
<p>主人公を操作して敵を倒すゲームです。<br />敵をすべて倒すとクリアです。</p>
<p>ブロックや、ドアなどの障害物があります。</p>
<p><img src="images/capture/stepa.png" /></p>
<ul>
<li>登場人物</li>
<li><img src="images/image10.png" /> 主人公</li>
<li><img src="images/image11.png" /> 普通の敵</li>
<li><img src="images/image12.png" /> 追いかけてくる敵</li>
<li><img src="images/image13.png" /> 障害物を作る敵</li>
<li><img src="images/image14.png" /> 障害物を壊す敵</li>
<li><img src="images/image15.png" /> 遠距離攻撃をする敵</li>
</ul>
<h3 class="break">プログラムの作成</h3>
<p>設計ができたら、実際にプログラムを作成していきます。<br />ソフトウェアはプログラムが書かれたいくつものファイルによって構成されています。</p>
<ol>
<li><p>エクスプローラで確認してみよう。</p></li>
<li><p>エディタで『main.rb』を開いてみよう。プログラムが書かれていることがわかります。</p></li>
<li><p>プログラムは <strong>半角英数字と記号</strong> で書きます。全角と半角に気をつけよう。また、大文字、小文字も区別するので注意しよう。</p></li>
<li><p>何かプログラムを書いたら、必ず保存を実行しよう。また、ファイル名には半角英数字を使うことに気をつけよう。</p></li>
</ol>
<h3>ソフトウェアの実行</h3>
<p>作成したソフトウェアを実行するには、コマンドプロンプトを使います。エクスプローラでダブルクリックするのではありません。<br />コマンドプロンプトを開いて、以下の文字列（コマンドと呼びます）を入力しエンターキーを押すと、プログラムの実行がはじまります。</p>
<pre><code>ruby main.rb</code></pre>
<p>最初は何も反応がありませんが、プログラムを徐々に追加していくとゲームとして動くようになります。</p>
<h2 class="break">ゲームの作成</h2>
<p>今まで学んだ知識を使いながら、一緒にゲームを作っていきましょう。</p>
<h3 id="1.">ステップ1.ウィンドウとプレーヤーを表示する</h3>
<p>最初は、ゲームのベースとなるウィンドウと主人公を表示してみましょう。</p>
<h4 id="main.rb">main.rb</h4>
<p>『main.rb』をエディタで開いて、以下のようにプログラムを追加してみてください。<br />プログラムを入力したら、忘れずに保存しよう。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">require_relative  <span class="st">&quot;./bomber&quot;</span>

<span class="dt">Window</span>.height += <span class="dv">64</span>

player = <span class="dt">Bomber</span>::<span class="dt">Player</span>.new(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)

player.on(<span class="st">:start</span>) <span class="kw">do</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bomberplayer.rb">bomber/player.rb</h4>
<p>エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『player.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Player</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="ot">attr_accessor</span> <span class="st">:guide</span>, <span class="st">:agl</span>
    <span class="kw">def</span> initialize(x, y, angle)
      <span class="dv">super</span>(costume_lists, x, y, angle)
      <span class="ot">@agl</span> = <span class="st">:right</span>
    <span class="kw">end</span>

    <span class="kw">def</span> costume_lists
      [<span class="st">&quot;../image/hito.png&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> move(move_angle=<span class="st">:right</span>)
      <span class="kw">if</span> <span class="dv">self</span>.agl == move_angle
        <span class="dv">self</span>.send(<span class="st">&quot;move_</span><span class="ot">#{</span>move_angle.to_s<span class="ot">}</span><span class="st">&quot;</span>.to_sym)
        sleep <span class="fl">0.1</span>
      <span class="kw">end</span>
      angle_shift(move_angle)
    <span class="kw">end</span>

    <span class="kw">def</span> lose
      <span class="dv">super</span>
      sleep <span class="dv">3</span>
      exit
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開けば、ステップ1は終了です。</p>
<p><img src="images/capture/step2.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="2.">ステップ2.主人公を動かす</h3>
<p>次は、主人公をキーボードを使って動かしてみましょう。<br />また、主人公が向いている方向を示すガイド機能も作りましょう。</p>
<h4 id="bomberguide.rb">bomber/guide.rb</h4>
<p>まず、主人公が向いている方向を示すガイド機能を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『guide.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Guide</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> initialize(target)
      <span class="ot">@target</span> = target
      <span class="dv">super</span>(costume_lists, <span class="ot">@target</span>.x, <span class="ot">@target</span>.y, <span class="dv">0</span>)
    <span class="kw">end</span>

    <span class="kw">def</span> costume_lists
      [<span class="st">&quot;../image/up.png&quot;</span>,
       <span class="st">&quot;../image/down.png&quot;</span>,
       <span class="st">&quot;../image/left.png&quot;</span>,
       <span class="st">&quot;../image/right.png&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> trace
      agl = <span class="ot">@target</span>.agl
      <span class="dv">self</span>.x, <span class="dv">self</span>.y = <span class="ot">@target</span>.x, <span class="ot">@target</span>.y
      <span class="kw">case</span> agl
      <span class="kw">when</span> <span class="st">:up</span>
        <span class="dv">self</span>.y -= <span class="dv">4</span>
        <span class="dv">self</span>.image = <span class="ot">@costumes</span>[<span class="dv">0</span>]
      <span class="kw">when</span> <span class="st">:down</span>
        <span class="dv">self</span>.y += <span class="dv">32</span>
        <span class="dv">self</span>.image = <span class="ot">@costumes</span>[<span class="dv">1</span>]
      <span class="kw">when</span> <span class="st">:left</span>
        <span class="dv">self</span>.x -= <span class="dv">4</span>
        <span class="dv">self</span>.image = <span class="ot">@costumes</span>[<span class="dv">2</span>]
      <span class="kw">when</span> <span class="st">:right</span>
        <span class="dv">self</span>.x += <span class="dv">32</span>
        <span class="dv">self</span>.image = <span class="ot">@costumes</span>[<span class="dv">3</span>]
      <span class="kw">end</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<p>ここで、</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby">    <span class="kw">def</span> costume_lists
      [<span class="st">&quot;../image/up.png&quot;</span>,
       <span class="st">&quot;../image/down.png&quot;</span>,
       <span class="st">&quot;../image/left.png&quot;</span>,
       <span class="st">&quot;../image/right.png&quot;</span>]
    <span class="kw">end</span></code></pre></div>
<p>は、ガイドに使用する画像を指定する処理です。</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby">      <span class="kw">case</span> agl
      <span class="kw">when</span> <span class="st">:up</span>
        <span class="dv">self</span>.y -= <span class="dv">4</span>
        <span class="dv">self</span>.image = <span class="ot">@costumes</span>[<span class="dv">0</span>]</code></pre></div>
<p>は、主人公の位置からみて、どの位置にガイドを表示するかを指定する処理です。xやyは座標です。</p>
<h4 id="bomberplayer.rb-1">bomber/player.rb</h4>
<p>上記で作成したガイドを主人公のまわりに表示されるようにします。<br />キーボードが押されたら、押された方向に合わせてガイドが表示されるようにします。<br />以下となるように、『player.rb』にプログラムを追加します。</p>
<div class="sourceCode" startFrom="4"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">    <span class="kw">def</span> initialize(x, y, angle)
      <span class="dv">super</span>(costume_lists, x, y, angle)
      <span class="ot">@agl</span> = <span class="st">:right</span>
      <span class="ot">@agl</span> = <span class="st">:right</span>
      <span class="ot">@guide</span> = <span class="dt">Bomber</span>::<span class="dt">Guide</span>.new(<span class="dv">self</span>)
      <span class="ot">@guide</span>.trace
    <span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="main.rb-1">main.rb</h4>
<p>最後に、キーボードが押されたときにキャラクターを動かす処理を追加します。<br />『main.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">require_relative  <span class="st">&quot;./bomber&quot;</span>

<span class="dt">Window</span>.height += <span class="dv">64</span>

<span class="dt">$score</span> = <span class="dv">0</span>

<span class="dt">$all_obj</span> = <span class="dt">Array</span>.new
<span class="dt">$hit_obj</span> = <span class="dt">Array</span>.new

player = <span class="dt">Bomber</span>::<span class="dt">Player</span>.new(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="dt">$all_obj</span> &lt;&lt; player
<span class="dt">$all_obj</span>.flatten!

<span class="dt">$hit_obj</span> &lt;&lt; player
<span class="dt">$hit_obj</span>.flatten!

player.on(<span class="st">:start</span>) <span class="kw">do</span>
  on(<span class="st">:key_down</span>, <span class="dt">K_RIGHT</span>) <span class="kw">do</span>
    <span class="dv">self</span>.move(<span class="st">:right</span>)
  <span class="kw">end</span>

  on(<span class="st">:key_down</span>, <span class="dt">K_LEFT</span>) <span class="kw">do</span>
    <span class="dv">self</span>.move(<span class="st">:left</span>)
  <span class="kw">end</span>

  on(<span class="st">:key_down</span>, <span class="dt">K_UP</span>) <span class="kw">do</span>
    <span class="dv">self</span>.move(<span class="st">:up</span>)
  <span class="kw">end</span>

  on(<span class="st">:key_down</span>, <span class="dt">K_DOWN</span>) <span class="kw">do</span>
    <span class="dv">self</span>.move(<span class="st">:down</span>)
  <span class="kw">end</span>

<span class="kw">end</span></code></pre></td></tr></table></div>
<p>ここで、</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby">  on(<span class="st">:key_down</span>, <span class="dt">K_RIGHT</span>) <span class="kw">do</span>
    <span class="dv">self</span>.move(<span class="st">:right</span>)
  <span class="kw">end</span></code></pre></div>
<p>は、キーボードの「→」が押されたとき、主人公を右に動かすという処理です。</p>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、キーボードで主人公が動くことを確認できたら、ステップ2は終了です。</p>
<p><img src="images/capture/step3.png" /></p>
<p>ウィンドウが開かない、主人公が動かないなどは、プログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="3.">ステップ3.ウィンドウにブロックを配置する</h3>
<p>次は、殺風景なウィンドウにブロックを配置してみましょう。</p>
<h4 id="bomberblock.rb">bomber/block.rb</h4>
<p>まず、ブロックを表現するオブジェクトを作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『block.rb』として保存します。<br />長いので、間違えないように注意して入力しよう。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Block</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="ot">attr_accessor</span> <span class="st">:col</span>
    <span class="kw">def</span> initialize(data)
      <span class="kw">if</span> data.class == <span class="dt">Hash</span>
        <span class="ot">@col</span> = data[<span class="st">&#39;col&#39;</span>]
        <span class="dv">super</span>(<span class="st">&quot;../image/block_</span><span class="ot">#{</span>data[<span class="st">&#39;col&#39;</span>]<span class="ot">}</span><span class="st">.png&quot;</span>, data[<span class="st">&quot;x&quot;</span>].to_i, data[<span class="st">&quot;y&quot;</span>].to_i, <span class="dv">0</span>)
      <span class="kw">elsif</span> data.class == <span class="dt">Array</span>
        <span class="dv">super</span>(costume_lists, data[<span class="dv">0</span>], data[<span class="dv">1</span>], <span class="dv">0</span>)
      <span class="kw">end</span>
      <span class="dv">self</span>.z = <span class="dv">0</span>
    <span class="kw">end</span>

    <span class="kw">def</span> destroy
      <span class="kw">return</span> <span class="kw">if</span> <span class="dv">self</span>.wall?
      <span class="dt">$hit_obj</span> -= [<span class="dv">self</span>]
      <span class="dt">$all_obj</span> -= [<span class="dv">self</span>]
      fire = <span class="dt">Bomber</span>::<span class="dt">Fire</span>.new(*<span class="dv">self</span>.current_block)
      <span class="dv">self</span>.vanish
      sleep <span class="fl">0.1</span>
      fire.vanish
    <span class="kw">end</span>

    <span class="kw">def</span> wall?
      <span class="dv">self</span>.current_y_block == <span class="dv">0</span> <span class="kw">or</span> <span class="dv">self</span>.current_y_block == <span class="dt">HEIGHT</span> <span class="kw">or</span> <span class="dv">self</span>.current_x_block == <span class="dv">0</span> <span class="kw">or</span> <span class="dv">self</span>.current_x_block == <span class="dt">WIDTH</span>
    <span class="kw">end</span>

    <span class="kw">def</span> costume_lists
      [<span class="st">&quot;../image/block_stone.png&quot;</span>,
       <span class="st">&quot;../image/block_brick.png&quot;</span>,
       <span class="st">&quot;../image/block_wood.png&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> collar_lists
      [<span class="st">&quot;stone&quot;</span>, <span class="st">&quot;brick&quot;</span>, <span class="st">&quot;wood&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> add_event
      <span class="kw">if</span> <span class="dt">Input</span>.mouse_push?(<span class="dt">M_LBUTTON</span>)
        <span class="dt">$blocks</span> -= [<span class="dv">self</span>]
        <span class="dv">self</span>.vanish
      <span class="kw">elsif</span> <span class="dt">Input</span>.mouse_push?(<span class="dt">M_RBUTTON</span>)
        next_costume
        puts <span class="dv">self</span>.image.inspect
      <span class="kw">else</span>
      <span class="kw">end</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bomberdoor.rb">bomber/door.rb</h4>
<p>ブロックだけでなく、主人公が開けることができるドアオブジェクトも作りましょう。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『door.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Door</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="ot">attr_accessor</span> <span class="st">:close</span>
    <span class="kw">def</span> initialize(*data)
      <span class="ot">@close</span> = <span class="dv">true</span>
      <span class="dv">super</span>(costume_lists(data[<span class="dv">2</span>]), data[<span class="dv">0</span>].to_i, data[<span class="dv">1</span>].to_i, <span class="dv">0</span>)
      <span class="dv">self</span>.z = <span class="dv">0</span>
    <span class="kw">end</span>

    <span class="kw">def</span> costume_lists(data=<span class="st">:up</span>)
      [<span class="st">&quot;../image/door_</span><span class="ot">#{</span>data.to_s<span class="ot">}</span><span class="st">_close.png&quot;</span>,
       <span class="st">&quot;../image/door_</span><span class="ot">#{</span>data.to_s<span class="ot">}</span><span class="st">_open.png&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> lose
      next_costume
      <span class="ot">@close</span> = !<span class="ot">@close</span>
      <span class="kw">if</span> <span class="ot">@close</span>
        <span class="dt">$hit_obj</span> &lt;&lt; <span class="dv">self</span>
      <span class="kw">else</span>
        <span class="dt">$hit_obj</span> -= [<span class="dv">self</span>]
      <span class="kw">end</span>
    <span class="kw">end</span>

    <span class="kw">def</span> destroy
      <span class="kw">return</span> <span class="kw">if</span> <span class="dv">self</span>.current_y_block == <span class="dv">0</span> <span class="kw">or</span> <span class="dv">self</span>.current_y_block == <span class="dt">HEIGHT</span> <span class="kw">or</span> <span class="dv">self</span>.current_x_block == <span class="dv">0</span> <span class="kw">or</span> <span class="dv">self</span>.current_x_block == <span class="dt">WIDTH</span>
      <span class="dt">$hit_obj</span> -= [<span class="dv">self</span>]
      <span class="dt">$all_obj</span> -= [<span class="dv">self</span>]
      fire = <span class="dt">Bomber</span>::<span class="dt">Fire</span>.new(*<span class="dv">self</span>.current_block)
      <span class="dv">self</span>.vanish
      sleep <span class="fl">0.1</span>
      fire.vanish
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="main.rb-2">main.rb</h4>
<p>最後に、ウィンドウにブロックとドアを配置する処理を追加します。<br />『main.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">require_relative  <span class="st">&quot;./bomber&quot;</span>

<span class="dt">Window</span>.height += <span class="dv">64</span>

<span class="dt">$score</span> = <span class="dv">0</span>

<span class="dt">$all_obj</span> = <span class="dt">Array</span>.new
<span class="dt">$hit_obj</span> = <span class="dt">Array</span>.new

<span class="dt">$blocks</span> = <span class="dt">Array</span>.new
datas = <span class="dt">YAML</span>.load_file(<span class="dt">File</span>.expand_path(<span class="st">&quot;../config.yml&quot;</span>, <span class="dv">__FILE__</span>))
datas.each <span class="kw">do</span> |data|
  <span class="dt">$blocks</span> &lt;&lt; block =  <span class="dt">Bomber</span>::<span class="dt">Block</span>.new(data)
<span class="kw">end</span>

doors = <span class="dt">Array</span>.new
doors &lt;&lt; door1 = <span class="dt">Bomber</span>::<span class="dt">Door</span>.new( <span class="dv">8</span>,  <span class="dv">4</span>, <span class="st">:up</span>)
doors &lt;&lt; door2 = <span class="dt">Bomber</span>::<span class="dt">Door</span>.new( <span class="dv">6</span>,  <span class="dv">6</span>, <span class="st">:left</span>)
doors &lt;&lt; door3 = <span class="dt">Bomber</span>::<span class="dt">Door</span>.new(<span class="dv">10</span>,  <span class="dv">6</span>, <span class="st">:right</span>)
doors &lt;&lt; door4 = <span class="dt">Bomber</span>::<span class="dt">Door</span>.new( <span class="dv">8</span>,  <span class="dv">8</span>, <span class="st">:down</span>)

player = <span class="dt">Bomber</span>::<span class="dt">Player</span>.new(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="dt">$all_obj</span> &lt;&lt; player
<span class="dt">$all_obj</span> &lt;&lt; <span class="dt">$blocks</span>
<span class="dt">$all_obj</span> &lt;&lt; doors
<span class="dt">$all_obj</span>.flatten!

<span class="dt">$hit_obj</span> &lt;&lt; <span class="dt">$blocks</span>
<span class="dt">$hit_obj</span> &lt;&lt; doors
<span class="dt">$hit_obj</span> &lt;&lt; player
<span class="dt">$hit_obj</span>.flatten!</code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開けば、ステップ3は終了です。<br />念のため、主人公がキーボードで操作できるかも確認してみましょう。</p>
<p><img src="images/capture/step4.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="4.">ステップ4.敵を作る</h3>
<p>次は、主人公以外のキャラクターを作ってみましょう。</p>
<h4 id="bomberenemy_normal.rb">bomber/enemy_normal.rb</h4>
<p>敵を表現するオブジェクトを作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『enemy_normal.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">EnemyNormal</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="ot">attr_accessor</span> <span class="st">:guide</span>, <span class="st">:agl</span>
    <span class="kw">def</span> initialize(x, y, angle, delay=<span class="dv">0</span>)
      <span class="dv">super</span>(costume_lists, x, y, angle)
      <span class="ot">@score</span> = <span class="dv">5</span>
      <span class="ot">@agl</span> = <span class="st">:right</span>
      <span class="ot">@delay</span> = delay
      <span class="ot">@guide</span> = <span class="dt">Bomber</span>::<span class="dt">Guide</span>.new(<span class="dv">self</span>)
      <span class="ot">@guide</span>.trace
    <span class="kw">end</span>

    <span class="kw">def</span> costume_lists
      [<span class="st">&quot;../image/ene.png&quot;</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> action_list
      [<span class="st">:up</span>, <span class="st">:down</span>, <span class="st">:right</span>, <span class="st">:left</span>]
    <span class="kw">end</span>

    <span class="kw">def</span> auto
      <span class="dv">super</span>
      random_move
    <span class="kw">end</span>

    <span class="kw">def</span> random_move
      num = rand(<span class="dv">4</span>)
      sleep <span class="ot">@delay</span>
      sleep <span class="fl">0.3</span>
      <span class="dv">self</span>.send(<span class="st">&quot;move_</span><span class="ot">#{</span>action_list[num].to_s<span class="ot">}</span><span class="st">&quot;</span>.to_sym)
      sleep <span class="fl">0.2</span>
      <span class="dv">self</span>.send(<span class="st">&quot;move_</span><span class="ot">#{</span>action_list[num].to_s<span class="ot">}</span><span class="st">&quot;</span>.to_sym)
      reject_half
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="main.rb-3">main.rb</h4>
<p>ウィンドウに敵を配置する処理を追加します。<br />『main.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="22"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">player = <span class="dt">Bomber</span>::<span class="dt">Player</span>.new(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="dt">$all_obj</span> &lt;&lt; player

<span class="dt">$enemy</span> = <span class="dt">Array</span>.new
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new( <span class="dv">1</span>, <span class="dv">13</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new( <span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.4</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new( <span class="dv">8</span>,  <span class="dv">7</span>, <span class="dv">0</span>,   <span class="dv">0</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">10</span>,  <span class="dv">8</span>, <span class="dv">0</span>, <span class="fl">0.2</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">12</span>,  <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">13</span>, <span class="dv">13</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">15</span>, <span class="dv">11</span>, <span class="dv">0</span>, <span class="fl">0.2</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">18</span>,  <span class="dv">1</span>, <span class="dv">0</span>,   <span class="dv">0</span>)

<span class="dt">$enemy</span>.each <span class="kw">do</span> |ene|
  ene.on(<span class="st">:start</span>) <span class="kw">do</span>
    while <span class="dv">self</span>.active <span class="kw">do</span>
      <span class="kw">if</span> <span class="dv">self</span>.active
        <span class="dv">self</span>.auto
      <span class="kw">end</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span>

<span class="dt">$all_obj</span> &lt;&lt; <span class="dt">$blocks</span>
<span class="dt">$all_obj</span> &lt;&lt; <span class="dt">$enemy</span>
<span class="dt">$all_obj</span> &lt;&lt; doors
<span class="dt">$all_obj</span>.flatten!

<span class="dt">$hit_obj</span> &lt;&lt; <span class="dt">$blocks</span>
<span class="dt">$hit_obj</span> &lt;&lt; <span class="dt">$enemy</span>
<span class="dt">$hit_obj</span> &lt;&lt; doors
<span class="dt">$hit_obj</span> &lt;&lt; player
<span class="dt">$hit_obj</span>.flatten!</code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、主人公のほかに敵が表示されていれば、ステップ4は終了です。</p>
<p><img src="images/capture/step5.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="5.">ステップ5.攻撃する、攻撃される</h3>
<h4 id="bomberfire.rb">bomber/fire.rb</h4>
<p>主人公が攻撃したときに火を吹くようにします。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『fire.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Fire</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> initialize(x, y)
      <span class="dv">super</span>(<span class="st">&quot;../image/fire.png&quot;</span>, x, y, <span class="dv">0</span>)
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bomberplayer.rb-2">bomber/player.rb</h4>
<p>主人公が攻撃する処理を追加します。<br />『player.rb』をエディタで開いて、以下となるようにプログラムを追加してください。</p>
<div class="sourceCode" startFrom="15"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
19
20
21
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">    <span class="kw">def</span> atack
      <span class="dv">super</span>
      <span class="kw">if</span> all_enemy.empty?
        sleep <span class="dv">3</span>
        exit
      <span class="kw">end</span>
    <span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bomberenemy_normal.rb-1">bomber/enemy_normal.rb</h4>
<p>敵が攻撃する処理を追加します。<br />『enemy_normal.rb』をエディタで開いて、以下となるように33行目のプログラムを追加してください。</p>
<div class="sourceCode" startFrom="32"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>32
33
34
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">      reject_half
      atack <span class="kw">if</span> rand(<span class="dv">5</span>) == <span class="dv">0</span>
    <span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="main.rb-4">main.rb</h4>
<p>最後に、キーボードのスペースを押したら、主人公が攻撃する処理を追加します。<br />『main.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="73"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>73
74
75
76
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">  on(<span class="st">:key_push</span>, <span class="dt">K_SPACE</span>) <span class="kw">do</span>
    atack
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、スペースキーを押したら主人公が攻撃するようになれば、ステップ5は終了です。</p>
<p><img src="images/capture/step6.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="6.">ステップ6.ゲームクリアとゲームオーバー</h3>
<h4 id="bombergame_clear.rb">bomber/game_clear.rb</h4>
<p>ゲームクリアの画面を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『game_clear.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">GameClear</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> initialize
      <span class="dv">super</span>(<span class="st">&quot;../image/gameclear.png&quot;</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
      <span class="dv">self</span>.z = <span class="dv">20</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bombergame_over.rb">bomber/game_over.rb</h4>
<p>ゲームオーバーの画面を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『game_over.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">GameOver</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> initialize
      <span class="dv">super</span>(<span class="st">&quot;../image/gameover.png&quot;</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
      <span class="dv">self</span>.z = <span class="dv">20</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="6.player">bomber/player.rb</h4>
<p>主人公が攻撃してすべての敵がいなくなったらゲームクリア、主人公が攻撃を受けたらゲームオーバーを表示するように処理を追加します。<br />『player.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="15"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">    <span class="kw">def</span> atack
      <span class="dv">super</span>
      <span class="kw">if</span> all_enemy.empty?
        sleep <span class="dv">1</span>
        gameclear = <span class="dt">Bomber</span>::<span class="dt">GameClear</span>.new
        gameclear.z = <span class="dv">10</span>
        sleep <span class="dv">3</span>
        exit
      <span class="kw">end</span>
    <span class="kw">end</span>

    <span class="kw">def</span> move(move_angle=<span class="st">:right</span>)
      <span class="kw">if</span> <span class="dv">self</span>.agl == move_angle
        <span class="dv">self</span>.send(<span class="st">&quot;move_</span><span class="ot">#{</span>move_angle.to_s<span class="ot">}</span><span class="st">&quot;</span>.to_sym)
        sleep <span class="fl">0.1</span>
      <span class="kw">end</span>
      angle_shift(move_angle)
    <span class="kw">end</span>

    <span class="kw">def</span> lose
      <span class="dv">super</span>
      sleep <span class="dv">1</span>
      gameover = <span class="dt">Bomber</span>::<span class="dt">GameOver</span>.new
      gameover.z = <span class="dv">10</span>
      sleep <span class="dv">3</span>
      exit
    <span class="kw">end</span></code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、ゲームクリア、ゲームオーバーが確認できたら、ステップ6は終了です。</p>
<p><img src="images/capture/step7.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="7.">ステップ7.敵のバリエーションを増やす</h3>
<h4 id="bomberenemy_hammer.rb">bomber/enemy_hammer.rb</h4>
<h4 id="bomberenemy_shooter.rb">bomber/enemy_shooter.rb</h4>
<h4 id="bomberenemy_trace.rb">bomber/enemy_trace.rb</h4>
<h4 id="bomberenemy_wizard.rb">bomber/enemy_wizard.rb</h4>
<h4 id="bomberarrow.rb">bomber/arrow.rb</h4>
<h4 id="main.rb-5">main.rb</h4>
<p>ウィンドウに新しい敵を配置する処理を追加します。<br />『main.rb』をエディタで開いて、以下となるようにプログラムを変更してください。</p>
<div class="sourceCode" startFrom="33"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyNormal</span>.new(<span class="dv">18</span>,  <span class="dv">1</span>, <span class="dv">0</span>,   <span class="dv">0</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new(  <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new(  <span class="dv">7</span>,  <span class="dv">3</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new(  <span class="dv">7</span>,  <span class="dv">6</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new(  <span class="dv">8</span>,  <span class="dv">9</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new( <span class="dv">13</span>,  <span class="dv">1</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyTrace</span>.new( <span class="dv">14</span>,  <span class="dv">3</span>, <span class="dv">0</span>, player)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyShooter</span>.new(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyShooter</span>.new(<span class="dv">10</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyWizard</span>.new(<span class="dv">13</span>,  <span class="dv">9</span>, <span class="dv">0</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyWizard</span>.new(<span class="dv">15</span>, <span class="dv">13</span>, <span class="dv">0</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyHammer</span>.new(<span class="dv">10</span>,  <span class="dv">3</span>, <span class="dv">0</span>)
<span class="dt">$enemy</span> &lt;&lt; <span class="dt">Bomber</span>::<span class="dt">EnemyHammer</span>.new(<span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">0</span>)

<span class="dt">$enemy</span>.each <span class="kw">do</span> |ene|</code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、敵が増えていることが確認できれば、ステップ7は終了です。</p>
<p><img src="images/capture/step8.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="8.">ステップ8.得点を表示する</h3>
<h4 id="bomberstatusbar.rb">bomber/statusbar.rb</h4>
<p>ステータスバーに残りの敵の数を表示する機能を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『statusbar.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Statusbar</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> enemy_status(num)
      font = new_font(<span class="dv">16</span>)
      width = <span class="dt">BLOCK</span>
      height = <span class="dt">BLOCK</span>
      image = <span class="dt">Image</span>.new(width, height)
      image.draw_font(<span class="dv">0</span>, (font.size + <span class="dv">1</span>), <span class="st">&quot;×</span><span class="ot">#{</span>num<span class="ot">}</span><span class="st">&quot;</span>, font, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])
      <span class="ot">@font</span> = <span class="dt">Sprite</span>.new(x+<span class="dt">BLOCK</span>, y-<span class="dt">BLOCK</span>/<span class="dv">4</span> , image)
      <span class="ot">@font</span>.draw
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bomberscore.rb">bomber/score.rb</h4>
<p>ステータスバーにスコアを表示する機能を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『score.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Score</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> score_status
      font = new_font(<span class="dv">20</span>)
      width = <span class="dt">BLOCK</span>*<span class="dv">20</span>
      height = <span class="dt">BLOCK</span>*<span class="dv">2</span>
      image = <span class="dt">Image</span>.new(width, height)
      image.draw_font(<span class="dv">0</span>, (font.size + <span class="dv">1</span>), <span class="st">&quot;得点 </span><span class="ot">#{</span><span class="dt">$score</span><span class="ot">}</span><span class="st"> 点&quot;</span>, font, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])
      <span class="ot">@font</span> = <span class="dt">Sprite</span>.new(x+<span class="dt">BLOCK</span>, y-<span class="dt">BLOCK</span>/<span class="dv">2</span> , image)
      <span class="ot">@font</span>.draw
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="bombertimer.rb">bomber/timer.rb</h4>
<p>ステータスバーに残り時間を表示する機能を作ります。<br />エディタで新規作成を選択して、新しいファイルを作ります。<br />以下のようにプログラムを入力し、bomberディレクトリに『timer.rb』として保存します。</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby"><span class="kw">module</span> <span class="dt">Bomber</span>
  <span class="kw">class</span> <span class="dt">Timer</span> &lt; <span class="dt">Bomber</span>::<span class="dt">Character</span>
    <span class="kw">def</span> initialize(costume, x, y, angle, timelimit)
      <span class="ot">@timelimit</span> = timelimit
      <span class="ot">@start_at</span> = <span class="dt">Time</span>.now
      <span class="dv">super</span>(costume, x, y, angle)
    <span class="kw">end</span>

    <span class="kw">def</span> time_status
      time = (<span class="dt">Time</span>.now - <span class="ot">@start_at</span>).to_i
      font = new_font(<span class="dv">20</span>)
      width = <span class="dt">BLOCK</span>*<span class="dv">20</span>
      height = <span class="dt">BLOCK</span>*<span class="dv">2</span>
      image = <span class="dt">Image</span>.new(width, height)
      image.draw_font(<span class="dv">0</span>, (font.size + <span class="dv">1</span>), <span class="st">&quot;残り時間 </span><span class="ot">#{@timelimit</span> - time<span class="ot">}</span><span class="st"> 秒&quot;</span>, font, [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])
      <span class="ot">@font</span> = <span class="dt">Sprite</span>.new(x+<span class="dt">BLOCK</span>, y-<span class="dt">BLOCK</span>/<span class="dv">2</span> , image)
      <span class="ot">@font</span>.draw
      <span class="kw">if</span> <span class="ot">@timelimit</span> - time &lt; <span class="dv">0</span>
        gameover = <span class="dt">Bomber</span>::<span class="dt">GameOver</span>.new
        gameover.z = <span class="dv">10</span>
        sleep <span class="dv">3</span>
        exit
      <span class="kw">end</span>
    <span class="kw">end</span>
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<h4 id="main.rb-6">main.rb</h4>
<p>ステータスバーに上記で作成した機能を配置する処理を追加します。<br />『main.rb』をエディタで開いて、以下のようなプログラムをファイルの最後に追加してください。</p>
<div class="sourceCode" startFrom="90"><table class="sourceCode ruby numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
</pre></td><td class="sourceCode"><pre><code class="sourceCode ruby">
statusbar1 = <span class="dt">Bomber</span>::<span class="dt">Statusbar</span>.new(<span class="st">&quot;../image/ene.png&quot;</span>, <span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">0</span>)
statusbar1.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.enemy_status(normal_enemy_count)
  <span class="kw">end</span>
<span class="kw">end</span>

statusbar2 = <span class="dt">Bomber</span>::<span class="dt">Statusbar</span>.new(<span class="st">&quot;../image/ene2.png&quot;</span>, <span class="dv">2</span>, <span class="dv">15</span>, <span class="dv">0</span>)
statusbar2.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.enemy_status(trace_enemy_count)
  <span class="kw">end</span>
<span class="kw">end</span>

statusbar3 = <span class="dt">Bomber</span>::<span class="dt">Statusbar</span>.new(<span class="st">&quot;../image/wiz.png&quot;</span>, <span class="dv">4</span>, <span class="dv">15</span>, <span class="dv">0</span>)
statusbar3.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.enemy_status(wizard_enemy_count)
  <span class="kw">end</span>
<span class="kw">end</span>

statusbar4 = <span class="dt">Bomber</span>::<span class="dt">Statusbar</span>.new(<span class="st">&quot;../image/hun.png&quot;</span>, <span class="dv">6</span>, <span class="dv">15</span>, <span class="dv">0</span>)
statusbar4.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.enemy_status(hammer_enemy_count)
  <span class="kw">end</span>
<span class="kw">end</span>

statusbar5 = <span class="dt">Bomber</span>::<span class="dt">Statusbar</span>.new(<span class="st">&quot;../image/bow.png&quot;</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">0</span>)
statusbar5.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.enemy_status(shooter_enemy_count)
  <span class="kw">end</span>
<span class="kw">end</span>

timer = <span class="dt">Bomber</span>::<span class="dt">Timer</span>.new(<span class="st">&quot;../image/clear.png&quot;</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">0</span>, <span class="dv">30</span>)
timer.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.time_status
  <span class="kw">end</span>
<span class="kw">end</span>

score = <span class="dt">Bomber</span>::<span class="dt">Score</span>.new(<span class="st">&quot;../image/clear.png&quot;</span>, <span class="dv">16</span>, <span class="dv">15</span>, <span class="dv">0</span>)
score.on(<span class="st">:start</span>) <span class="kw">do</span>
  loop <span class="kw">do</span>
    <span class="dv">self</span>.score_status
  <span class="kw">end</span>
<span class="kw">end</span></code></pre></td></tr></table></div>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開いて、ステータスバーが正常に表示されることが確認できれば、ステップ8は終了です。</p>
<p><img src="images/capture/step9.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<h3 class="break" id="9.">ステップ9.ブロックの設定画面</h3>
<h4 id="bomberback.rb">bomber/back.rb</h4>
<h4 id="config.rb">config.rb</h4>
<p>プログラムを保存したら、コマンドプロンプトを開いて、以下のコマンドを入力し、エンターキーを押してみましょう。</p>
<pre><code>ruby main.rb</code></pre>
<p>以下のようなウィンドウが開けば、ステップ9は終了です。</p>
<p><img src="images/capture/stepa.png" /></p>
<p>ウィンドウが開かない場合はプログラムが間違っているので見直しましょう。<br />コマンドプロンプトにエラーが出ているかもしれないので、確認してみましょう。</p>
<p>ここまででゲームの作成は完了です。</p>
</body>
</html>
