(function() {
  var ctags, fs, getTagsFile, path;

  path = require('path');

  ctags = require('ctags');

  fs = require('fs-plus');

  getTagsFile = function(directoryPath) {
    var tagsFile;
    tagsFile = path.join(directoryPath, "tags");
    if (fs.isFileSync(tagsFile)) {
      return tagsFile;
    }
    tagsFile = path.join(directoryPath, ".tags");
    if (fs.isFileSync(tagsFile)) {
      return tagsFile;
    }
    tagsFile = path.join(directoryPath, "TAGS");
    if (fs.isFileSync(tagsFile)) {
      return tagsFile;
    }
  };

  module.exports = function(directoryPath) {
    var callback, stream, tagsFilePath;
    tagsFilePath = getTagsFile(directoryPath);
    if (tagsFilePath) {
      callback = this.async();
      stream = ctags.createReadStream(tagsFilePath);
      stream.on('data', function(tags) {
        return emit('tags', tags);
      });
      stream.on('end', callback);
      return stream.on('error', callback);
    } else {
      return [];
    }
  };

}).call(this);
